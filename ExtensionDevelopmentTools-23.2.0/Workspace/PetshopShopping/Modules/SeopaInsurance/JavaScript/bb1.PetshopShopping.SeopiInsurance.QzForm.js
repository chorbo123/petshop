// @module bb1.PetshopShopping.SeopaInsurance
define(
 'bb1.PetshopShopping.SeopaInsurance.QzForm',
 [
  'Backbone',
  'underscore',
  'jQuery'
 ],
 function (
  Backbone,
  _,
  jQuery
 )
 {
  
  function QZ(e){var n=this;this.defaults={tagName:"qz",tagID:"qz_form",customUrl:"wl4",partnerUrl:"",dynamicHeight:!0,tagWidth:"100%",tagHeight:"100%",container:"qzFormDiv",sid:{name:"qid",value:"_GET"},tracking:[{name:"kw",value:"_GET"},{name:"utm_source",value:"_GET"},{name:"utm_medium",value:"_GET"},{name:"utm_campaign",value:"_GET"}],prefill:{reg:{name:"reg",value:"_GET"},estimatedValue:{name:"estimatedValue",value:"_GET"}},formType:"standard",extraParam:"",renewalCampaign:!1,phpFile:"index.php"},this.consts={scrolling:"no",style:"overflow: hidden;",frameBorder:"no",sandbox:"allow-top-navigation allow-scripts allow-forms allow-same-origin allow-popups allow-modals"},this.render=function(){this.config=this.getSettings(e);var t=document.createElement("iframe");t.scrolling=this.config.scrolling,t.style=this.config.style,t.frameBorder=this.config.frameBorder,t.onload=this.config.onload,t.sandbox=this.config.sandbox,t.onload=this.scrollToTop,t.name=this.config.tagName,t.id=this.config.tagID,1==this.config.renewalCampaign&&!0===this.checkRenewalCampaign()&&(this.config.phpFile="campaign.php"),t.src=this.getUrl();var i=this.setSid(this.config.sid);if(t.src+=t.src.indexOf("?")>-1?i:i.replace("&","?"),this.config.prefill){var e=this.setPrefill(this.config.prefill);t.src+=t.src.indexOf("?")>-1?e:e.replace("&","?")}var o="";try{this.config.tracking.forEach(function(e){o+=n.setTracking(e)}),t.src+=t.src.indexOf("?")>-1?o:o.replace("&","?")}catch(e){}this.config.extraParam&&(t.src+=t.src.indexOf("?")>-1?"&":"?",t.src+=this.config.extraParam);var r="partnerRef="+encodeURIComponent(window.location.href);if(t.src+=t.src.indexOf("?")>-1?"&":"?",t.src+=r,0===this.config.formType.localeCompare("standard")&&!0===this.isMobileQZ())return void window.location.replace(t.src);var a=!1!==this.config.dynamicHeight&&this.config.dynamicHeight;a?t.width="100%":(t.height=this.config.tagHeight,t.width=this.config.tagWidth),null!=document.getElementById(this.config.container)?document.getElementById(this.config.container).appendChild(t):document.getElementsByTagName("body")[0].appendChild(t),a&&iFrameResize({minHeight:1e3,checkOrigin:!1})},this.getSettings=function(e){return Object.assign({},this.defaults,e,this.consts)},this.scrollToTop=function(){window.scroll(0,0)},this.checkRenewalCampaign=function(){var e,n,t=window.location.search;try{for("?"===t[0]&&(t=t.slice(1)),t=t.split("&"),e=0;e<t.length;e++)if("string"==typeof(n=t[e].split("="))[0]&&0===n[0].localeCompare("renewalCampaign"))return!0}catch(e){return!1}return!1},this.getUrl=function(){var e;if(this.config.partnerUrl){e=/^((http|https):\/\/)/.test(this.config.partnerUrl)?this.config.partnerUrl:"https://"+this.config.partnerUrl}else e="https://"+this.config.customUrl+".quotezone.co.uk",e+="/"+this.config.product,e+="/"+this.config.phpFile+"?id="+this.config.id;return e},this.isMobileQZ=function(){try{if(sessionStorage.desktop)return!1;if(localStorage.mobile)return!0}catch(e){}var e=["iphone","ipad","android","blackberry","nokia","opera mini","windows mobile","windows phone","iemobile"];for(var n in e)if(navigator.userAgent.toString().toLowerCase().indexOf(e[n].toString().toLowerCase())>0)return!0;return!1},this.setPrefill=function(e){var n="";return["reg","estimatedValue"].forEach(function(t){if(e[t])if("string"==typeof e[t].value&&0===e[t].value.localeCompare("_GET")){var i,o,r=window.location.search,a=e[t].name;try{for("?"===r[0]&&(r=r.slice(1)),r=r.split("&"),i=0;i<r.length;i++)if("string"==typeof(o=r[i].split("="))[0]&&0===o[0].localeCompare(a)){n+="&"+t+"="+o[1];break}}catch(e){}}else n+="&"+t+"="+e[t].value}),n},this.setSid=function(e){var n="",t=e.name,i=e.value;if("string"==typeof i&&0===i.localeCompare("_GET")){var e,i,o=window.location.search;try{for("?"===o[0]&&(o=o.slice(1)),o=o.split("&"),e=0;e<o.length;e++)if("string"==typeof(i=o[e].split("="))[0]&&0===i[0].localeCompare(t)){n+="&sid="+i[1];break}}catch(e){}}else n+="&sid="+i;return n},this.setTracking=function(e){var n="",t=e.name,i=e.value;if("string"==typeof i&&0===i.localeCompare("_GET")){var e,i,o=window.location.search;try{for("?"===o[0]&&(o=o.slice(1)),o=o.split("&"),e=0;e<o.length;e++)if("string"==typeof(i=o[e].split("="))[0]&&0===i[0].localeCompare(t)){n+="&"+t+"="+i[1];break}}catch(e){}}else n+="&"+t+"="+i;return n},"function"!=typeof Object.assign&&(Object.assign=function(e){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var n=1;n<arguments.length;n++){var t=arguments[n];if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}),function(e){"use strict";function n(e,n,t){"addEventListener"in window?e.addEventListener(n,t,!1):"attachEvent"in window&&e.attachEvent("on"+n,t)}function t(e,n,t){"removeEventListener"in window?e.removeEventListener(n,t,!1):"detachEvent"in window&&e.detachEvent("on"+n,t)}function i(e){return R+"["+function(e){var n="Host page: "+e;return window.top!==window.self&&(n=window.parentIFrame&&window.parentIFrame.getId?window.parentIFrame.getId()+": "+e:"Nested host page: "+e),n}(e)+"]"}function o(e){return W[e]?W[e].log:O}function r(e,n){c("log",e,n,o(e))}function a(e,n){c("info",e,n,o(e))}function s(e,n){c("warn",e,n,!0)}function c(e,n,t,o){!0===o&&"object"==typeof window.console&&console[e](i(n),t)}function l(e){function i(){o("Height"),o("Width"),w(function(){p(T),g(I),E("resizedCallback",T)},T,"init")}function o(e){var n=Number(W[I]["max"+e]),t=Number(W[I]["min"+e]),i=e.toLowerCase(),o=Number(T[i]);r(I,"Checking "+i+" is in range "+t+"-"+n),t>o&&(o=t,r(I,"Set "+i+" to min value")),o>n&&(o=n,r(I,"Set "+i+" to max value")),T[i]=""+o}function c(e){return F.substr(F.indexOf(":")+z+e)}function l(e,n){k(function(){b("Send Page Info","pageInfo:"+function(){var e=document.body.getBoundingClientRect(),n=T.iframe.getBoundingClientRect();return JSON.stringify({iframeHeight:n.height,iframeWidth:n.width,clientHeight:Math.max(document.documentElement.clientHeight,window.innerHeight||0),clientWidth:Math.max(document.documentElement.clientWidth,window.innerWidth||0),offsetTop:parseInt(n.top-e.top,10),offsetLeft:parseInt(n.left-e.left,10),scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset})}(),e,n)},32)}function v(e){var n=e.getBoundingClientRect();return u(I),{x:Math.floor(Number(n.left)+Number(P.x)),y:Math.floor(Number(n.top)+Number(P.y))}}function x(e){var n=e?v(T.iframe):{x:0,y:0},t={x:Number(T.width)+n.x,y:Number(T.height)+n.y};r(I,"Reposition requested from iFrame (offset x:"+n.x+" y:"+n.y+")"),window.top!==window.self?window.parentIFrame?window.parentIFrame["scrollTo"+(e?"Offset":"")](t.x,t.y):s(I,"Unable to scroll to requested position, window.parentIFrame not found"):(P=t,C(),r(I,"--"))}function C(){!1!==E("scrollCallback",P)?g(I):m()}function E(e,n){return f(I,e,n)}var F=e.data,T={},I=null;"[iFrameResizerChild]Ready"===F?function(){for(var e in W)b("iFrame requested init",y(e),document.getElementById(e),e)}():R===(""+F).substr(0,S)&&F.substr(S).split(":")[0]in W?(T=function(){var e=F.substr(S).split(":");return{iframe:W[e[0]]&&W[e[0]].iframe,id:e[0],height:e[1],width:e[2],type:e[3]}}(),I=T.id,W[I]&&(W[I].loaded=!0),!function(){var e=T.type in{true:1,false:1,undefined:1};return e&&r(I,"Ignoring init message from meta parent page"),e}()&&function(e){var n=!0;return W[e]||(n=!1,s(T.type+" No settings for "+e+". Message was: "+F)),n}(I)&&(r(I,"Received: "+F),function(){var e=!0;return null===T.iframe&&(s(I,"IFrame ("+T.id+") not found"),e=!1),e}()&&function(){var n=e.origin,t=W[I]&&W[I].checkOrigin;if(t&&""+n!="null"&&!(t.constructor===Array?function(){var e=0,i=!1;for(r(I,"Checking connection is from allowed list of origins: "+t);e<t.length;e++)if(t[e]===n){i=!0;break}return i}():function(){var e=W[I]&&W[I].remoteHost;return r(I,"Checking connection is from: "+e),n===e}()))throw new Error("Unexpected message received from: "+n+" for "+T.iframe.id+". Message was: "+e.data+". This error can be disabled by setting the checkOrigin: false option or by providing of array of trusted domains.");return!0}()&&function(){switch(W[I]&&W[I].firstRun&&W[I]&&(W[I].firstRun=!1),T.type){case"close":W[I].closeRequestCallback?f(I,"closeRequestCallback",W[I].iframe):d(T.iframe);break;case"message":e=c(6),r(I,"MessageCallback passed: {iframe: "+T.iframe.id+", message: "+e+"}"),E("messageCallback",{iframe:T.iframe,message:JSON.parse(e)}),r(I,"--");break;case"scrollTo":x(!1);break;case"scrollToOffset":x(!0);break;case"pageInfo":l(W[I]&&W[I].iframe,I),function(){function e(e,n){function t(){W[o]?l(W[o].iframe,o):i()}["scroll","resize"].forEach(function(i){r(o,e+i+" listener for sendPageInfo"),n(window,i,t)})}function i(){e("Remove ",t)}var o=I;e("Add ",n),W[o]&&(W[o].stopPageInfo=i)}();break;case"pageInfoStop":W[I]&&W[I].stopPageInfo&&(W[I].stopPageInfo(),delete W[I].stopPageInfo);break;case"inPageLink":!function(e){var n=e.split("#")[1]||"",t=decodeURIComponent(n),i=document.getElementById(t)||document.getElementsByName(t)[0];i?function(){var e=v(i);r(I,"Moving to in page link (#"+n+") at x: "+e.x+" y: "+e.y),P={x:e.x,y:e.y},C(),r(I,"--")}():window.top!==window.self?window.parentIFrame?window.parentIFrame.moveToAnchor(n):r(I,"In page link #"+n+" not found and window.parentIFrame not found"):r(I,"In page link #"+n+" not found")}(c(9));break;case"reset":h(T);break;case"init":i(),E("initCallback",T.iframe);break;default:i()}var e}())):a(I,"Ignored: "+F)}function f(e,n,t){var i=null,o=null;if(W[e]){if("function"!=typeof(i=W[e][n]))throw new TypeError(n+" on iFrame["+e+"] is not a function");o=i(t)}return o}function d(e){var n=e.id;r(n,"Removing iFrame: "+n),e.parentNode&&e.parentNode.removeChild(e),f(n,"closedCallback",n),r(n,"--"),delete W[n]}function u(n){null===P&&r(n,"Get page position: "+(P={x:window.pageXOffset!==e?window.pageXOffset:document.documentElement.scrollLeft,y:window.pageYOffset!==e?window.pageYOffset:document.documentElement.scrollTop}).x+","+P.y)}function g(e){null!==P&&(window.scrollTo(P.x,P.y),r(e,"Set page position: "+P.x+","+P.y),m())}function m(){P=null}function h(e){r(e.id,"Size reset requested by "+("init"===e.type?"host page":"iFrame")),u(e.id),w(function(){p(e),b("reset","reset",e.iframe,e.id)},e,"reset")}function p(e){function n(n){e.iframe.style[n]=e[n]+"px",r(e.id,"IFrame ("+o+") "+n+" set to "+e[n]+"px")}function t(n){M||"0"!==e[n]||(M=!0,r(o,"Hidden iFrame detected, creating visibility listener"),function(){function e(){function e(e){function n(n){return"0px"===(W[e]&&W[e].iframe.style[n])}W[e]&&function(e){return null!==e.offsetParent}(W[e].iframe)&&(n("height")||n("width"))&&b("Visibility change","resize",W[e].iframe,e)}for(var n in W)e(n)}function n(n){r("window","Mutation observed: "+n[0].target+" "+n[0].type),k(e,16)}var t=window.MutationObserver||window.WebKitMutationObserver;t&&function(){var e=document.querySelector("body");new t(n).observe(e,{attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0})}()}())}function i(e){n(e),t(e)}var o=e.iframe.id;W[o]&&(W[o].sizeHeight&&i("height"),W[o].sizeWidth&&i("width"))}function w(e,n,t){t!==n.type&&H?(r(n.id,"Requesting animation frame"),H(e)):e()}function b(e,n,t,i,o){var a=!1;i=i||t.id,W[i]&&(function(){var o;t&&"contentWindow"in t&&null!==t.contentWindow?(o=W[i]&&W[i].targetOrigin,r(i,"["+e+"] Sending msg to iframe["+i+"] ("+n+") targetOrigin: "+o),t.contentWindow.postMessage(R+n,o)):s(i,"["+e+"] IFrame("+i+") not found")}(),o&&W[i]&&W[i].warningTimeout&&(W[i].msgTimeout=setTimeout(function(){!W[i]||W[i].loaded||a||(a=!0,s(i,"IFrame has not responded within "+W[i].warningTimeout/1e3+" seconds. Check iFrameResizer.contentWindow.js has been loaded in iFrame. This message can be ingored if everything is working, or you can set the warningTimeout option to a higher value or zero to suppress this warning."))},W[i].warningTimeout)))}function y(e){return e+":"+W[e].bodyMarginV1+":"+W[e].sizeWidth+":"+W[e].log+":"+W[e].interval+":"+W[e].enablePublicMethods+":"+W[e].autoResize+":"+W[e].bodyMargin+":"+W[e].heightCalculationMethod+":"+W[e].bodyBackground+":"+W[e].bodyPadding+":"+W[e].tolerance+":"+W[e].inPageLinks+":"+W[e].resizeFrom+":"+W[e].widthCalculationMethod}function v(t,i){var o=function(e){return e,""===e&&(t.id=e=function(){var e=i&&i.id||q.id+I++;return null!==document.getElementById(e)&&(e+=I++),e}(),O=(i||{}).log,e,r(e,"Added missing iframe ID: "+e+" ("+t.src+")")),e}(t.id);o in W&&"iFrameResizer"in t?s(o,"Ignored iFrame, already setup."):(function(e){e=e||{},W[o]={firstRun:!0,iframe:t,remoteHost:t.src.split("/").slice(0,3).join("/")},function(e){if("object"!=typeof e)throw new TypeError("Options is not an object")}(e),function(e){for(var n in q)q.hasOwnProperty(n)&&(W[o][n]=e.hasOwnProperty(n)?e[n]:q[n])}(e),W[o]&&(W[o].targetOrigin=!0===W[o].checkOrigin?function(e){return""===e||"file://"===e?"*":e}(W[o].remoteHost):"*")}(i),function(){switch(r(o,"IFrame scrolling "+(W[o]&&W[o].scrolling?"enabled":"disabled")+" for "+o),t.style.overflow=!1===(W[o]&&W[o].scrolling)?"hidden":"auto",W[o]&&W[o].scrolling){case!0:t.scrolling="yes";break;case!1:t.scrolling="no";break;default:t.scrolling=W[o]?W[o].scrolling:"no"}}(),function(){function e(e){1/0!==W[o][e]&&0!==W[o][e]&&(t.style[e]=W[o][e]+"px",r(o,"Set "+e+" = "+W[o][e]+"px"))}function n(e){if(W[o]["min"+e]>W[o]["max"+e])throw new Error("Value for min"+e+" can not be greater than max"+e)}n("Height"),n("Width"),e("maxHeight"),e("minHeight"),e("maxWidth"),e("minWidth")}(),("number"==typeof(W[o]&&W[o].bodyMargin)||"0"===(W[o]&&W[o].bodyMargin))&&(W[o].bodyMarginV1=W[o].bodyMargin,W[o].bodyMargin=W[o].bodyMargin+"px"),function(i){n(t,"load",function(){b("iFrame.onload",i,t,e,!0),function(){var e=W[o]&&W[o].firstRun,n=W[o]&&W[o].heightCalculationMethod in N;!e&&n&&h({iframe:t,height:0,width:0,type:"init"})}()}),b("init",i,t,e,!0)}(y(o)),Function.prototype.bind&&W[o]&&(W[o].iframe.iFrameResizer={close:d.bind(null,W[o].iframe),resize:b.bind(null,"Window resize","resize",W[o].iframe),moveToAnchor:function(e){b("Move to anchor","moveToAnchor:"+e,W[o].iframe,o)},sendMessage:function(e){b("Send Message","message:"+(e=JSON.stringify(e)),W[o].iframe,o)}}))}function k(e,n){null===j&&(j=setTimeout(function(){j=null,e()},n))}function x(e){r("window","Trigger event: "+e),k(function(){E("Window "+e,"resize")},16)}function C(){"hidden"!==document.visibilityState&&(r("document","Trigger event: Visiblity change"),k(function(){E("Tab Visable","resize")},16))}function E(e,n){function t(e){return W[e]&&"parent"===W[e].resizeFrom&&W[e].autoResize&&!W[e].firstRun}for(var i in W)t(i)&&b(e,n,document.getElementById(i),i)}function F(){n(window,"message",l),n(window,"resize",function(){x("resize")}),n(document,"visibilitychange",C),n(document,"-webkit-visibilitychange",C),n(window,"focusin",function(){x("focus")}),n(window,"focus",function(){x("focus")})}function T(){function n(e,n){n&&(function(){if(!n.tagName)throw new TypeError("Object is not a valid DOM element");if("IFRAME"!==n.tagName.toUpperCase())throw new TypeError("Expected <IFRAME> tag, found <"+n.tagName+">")}(),v(n,e),t.push(n))}var t;return function(){var e,n=["moz","webkit","o","ms"];for(e=0;e<n.length&&!H;e+=1)H=window[n[e]+"RequestAnimationFrame"];H||r("setup","RequestAnimationFrame not supported")}(),F(),function(i,o){switch(t=[],function(e){e&&e.enablePublicMethods&&s("enablePublicMethods option has been removed, public methods are now always available in the iFrame")}(i),typeof o){case"undefined":case"string":Array.prototype.forEach.call(document.querySelectorAll(o||"iframe"),n.bind(e,i));break;case"object":n(i,o);break;default:throw new TypeError("Unexpected data type ("+typeof o+")")}return t}}if("undefined"!=typeof window){var I=0,O=!1,M=!1,z="message".length,R="[iFrameSizer]",S=R.length,P=null,H=window.requestAnimationFrame,N={max:1,scroll:1,bodyScroll:1,documentElementScroll:1},W={},j=null,q={autoResize:!0,bodyBackground:null,bodyMargin:null,bodyMarginV1:8,bodyPadding:null,checkOrigin:!0,inPageLinks:!1,enablePublicMethods:!0,heightCalculationMethod:"bodyOffset",id:"iFrameResizer",interval:32,log:!1,maxHeight:1/0,maxWidth:1/0,minHeight:0,minWidth:0,resizeFrom:"parent",scrolling:!1,sizeHeight:!0,sizeWidth:!1,warningTimeout:5e3,tolerance:0,widthCalculationMethod:"scroll",closedCallback:function(){},initCallback:function(){},messageCallback:function(){s("MessageCallback function not defined")},resizedCallback:function(){},scrollCallback:function(){return!0}};window.jQuery&&function(e){e.fn?e.fn.iFrameResize||(e.fn.iFrameResize=function(e){return this.filter("iframe").each(function(n,t){v(t,e)}).end()}):a("","Unable to bind to jQuery, it is not fully loaded.")}(window.jQuery),"function"==typeof define&&define.amd?define("SeopaInsurance.qzForm", [],T):"object"==typeof module&&"object"==typeof module.exports?module.exports=T():window.iFrameResize=window.iFrameResize||T()}}(),"loading"!==document.readyState?n.render():document.addEventListener("DOMContentLoaded",function(){n.render()})}

  window.QZ = QZ;
  
 }
);
